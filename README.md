# ğŸŒ ë”¥ëŸ¬ë‹ í•™ìŠµë„ìš°ë¯¸
## 1. í”„ë¡œì íŠ¸ ì†Œê°œ
### í•™ìŠµ ë°©í•´ ìš”ì†Œë¥¼ í™•ì¸í•˜ëŠ” ë”¥ëŸ¬ë‹ ëª¨ë¸ ê°œë°œ
<p align=center width="100%">
  <img src="/image/door.gif" height="300" width="22%" style="float:left">
  <img src="/image/snack.gif" height="300" width="22%" style="float:left">
  <img src="/image/desk.gif" height="300" width="22%" style="float:left">
  <img src="/image/phone.gif" height="300" width="22%" style="float:left">
</p>

- ê°ì²´ ì¸ì‹
  - ë¬¸ ê°œí ì—¬ë¶€: open / closed
  - ê°„ì‹ ìƒì ì±„ì›Œì§„ ë¹„ìœ¨: 0%, 25%, 50%, 75%, 100%
  - ì±…ìƒ ìœ„ ì‚¬ë¬¼: ì“°ë ˆê¸°(ë¹„ë‹, í”Œë¼ìŠ¤í‹±, ì¢…ì´, íœ´ì§€, ì»¤í”¼ì»µ), ê·¸ì™¸(ì¿ í‚¤, ì»¤í”¼)
- ë¶„ë¥˜
  - ìì„¸: íœ´ëŒ€í° ì‚¬ìš© ì¤‘ / ì§‘ì¤‘í•˜ê³  ìˆìŒ
  - ë°ê¸°: ë°ìŒ / ì–´ë‘ì›€
 
- í”„ë¡œì íŠ¸ ê¸°ê°„: 2023.11.17 ~ 12.15

### ê¸°ìˆ  ìŠ¤íƒ
|   |   |
|---|---|
|ê°œë°œí™˜ê²½|![Visual Studio Code](https://img.shields.io/badge/Visual%20Studio%20Code-007ACC?style=for-the-badge&logo=Visual%20Studio%20Code&logoColor=white) ![Git](https://img.shields.io/badge/Git-F05032?style=for-the-badge&logo=Git&logoColor=white) ![Github](https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=GitHub&logoColor=white) ![RDS](https://img.shields.io/badge/AWS%20RDS-527FFF?style=for-the-badge&logo=Amazon%20RDS&logoColor=white) ![S3](https://img.shields.io/badge/AWS%20S3-569A31?style=for-the-badge&logo=Amazon%20S3&logoColor=white) ![Qt](https://img.shields.io/badge/Qt-41CD52?style=for-the-badge&logo=Qt&logoColor=white)||
|ê¸°ìˆ |![Python](https://img.shields.io/badge/python-3776AB?style=for-the-badge&logo=python&logoColor=white) ![PyTorch](https://img.shields.io/badge/PyTorch-EE4C2C?style=for-the-badge&logo=PyTorch&logoColor=white) ![Tensorflow](https://img.shields.io/badge/Tensorflow-FF6F00?style=for-the-badge&logo=Tensorflow&logoColor=white) ![ROS2](https://img.shields.io/badge/ROS2-22314E?style=for-the-badge&logo=ROS&logoColor=white) ![Docker](https://img.shields.io/badge/Docker-2496ED?style=for-the-badge&logo=Docker&logoColor=white) ![Mysql](https://img.shields.io/badge/mysql-4479A1?style=for-the-badge&logo=mysql&logoColor=white)|
|ì»¤ë®¤ë‹ˆì¼€ì´ì…˜|![Jira](https://img.shields.io/badge/Jira-0052CC?style=for-the-badge&logo=Jira&logoColor=white) ![Confluence](https://img.shields.io/badge/Confluence-172B4D?style=for-the-badge&logo=Confluence&logoColor=white) ![Slack](https://img.shields.io/badge/slack-4A154B?style=for-the-badge&logo=slack&logoColor=white)|

### ì£¼ìš” ê¸°ëŠ¥
![Screenshot from 2023-12-14 20-16-41](https://github.com/addinedu-ros-3rd/deeplearning-repo-4/assets/86283716/bcdc6e39-b7c3-45e0-b3db-93ad594d28a4)

## 2. ê°œë°œ ë¬¸ì„œ
### ì‹œìŠ¤í…œ êµ¬ì„±ë„
<p align="center">
  <img src="https://github.com/addinedu-ros-3rd/deeplearning-repo-4/assets/86283716/afc45aae-57bc-4871-a21b-c6758ac1c98d" width="90%" style="float:left">
</p>

<br><br>

### ì‹¤ì‹œê°„ ì‹œë‚˜ë¦¬ì˜¤
<p align="center">
  <img src="https://github.com/addinedu-ros-3rd/deeplearning-repo-4/assets/86283716/1638e49e-4856-4cb7-81df-ae5777c056c4" width="90%" style="float:left">
</p>

<br><br>

### ì €ì¥ëœ ì˜ìƒ í™•ì¸ ì‹œë‚˜ë¦¬ì˜¤
<p align="center">
  <img src="https://github.com/addinedu-ros-3rd/deeplearning-repo-4/assets/86283716/4331709c-9ba8-4cc9-895f-cdb1d0a18c7b" width="90%" style="float:left">
</p>

<br><br>

### ê°ì²´ ì¸ì‹ ë°ì´í„° êµ¬ì¡°
<p align="center">
  <img src="https://github.com/addinedu-ros-3rd/deeplearning-repo-4/assets/146153568/cdcd0e05-f24b-4878-8a63-9a0eee9687b2" width="70%" style="float:left">
</p>

## 3. ì‹¤í–‰ ë°©ë²•
### 3-1. ë”¥ëŸ¬ë‹ ëª¨ë¸: ë„ì»¤ í™˜ê²½
- deploy ë””ë ‰í† ë¦¬ì—ì„œ
  ```
  docker compose up -d
  ```
  ë¡œ ì´ë¯¸ì§€ ë¹Œë“œ í›„ ì‹¤í–‰ ì‹œ, ì‚¬ìš©í•˜ëŠ” PCì˜ ì›¹ìº ê³¼ ë””ìŠ¤í”Œë ˆì´ì— ì—°ë™í•˜ì—¬ ëª¨ë¸ ì„±ëŠ¥ í™•ì¸ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### 3-2. UI/DB/S3/ROS2 ì—°ë™ í”„ë¡œê·¸ë¨ ì‹¤í–‰: ë¡œì»¬ PC
0. ì´¬ì˜í•œ ì˜ìƒ ì €ì¥ê³¼ ì¡°íšŒë¥¼ ìœ„í•´ì„œëŠ” AWS S3 bucketê³¼ IAM ìƒì„±ì´ í•„ìš”í•©ë‹ˆë‹¤. ì´ ì„¤ì •ì´ ì—†ì„ ê²½ìš° ì‹¤ì‹œê°„ ì¸ì‹ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.
1. ros_cam í”„ë¡œì íŠ¸(https://github.com/ros-drivers/usb_cam) ì™€ ì§ì ‘ ì‘ì„±í•œ ros_dl í”„ë¡œì íŠ¸ë¥¼ ë™ì‹œì— ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.
  - ros_camì„ ì‹¤í–‰í•œ PCì™€ USBë¡œ ì—°ê²°ëœ ì¹´ë©”ë¼ì˜ /image_raw í† í”½ì„ ë°›ì•„ì˜¬ ìˆ˜ ìˆëŠ”(ê°™ì€ ROS_DOMAIN_IDë¥¼ ê°€ì§„) PCì—ì„œ ros_dl í”„ë¡œì íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
  - í•˜ë‚˜ì˜ PCì—ì„œ ros_camê³¼ ros_dlì„ ë™ì‹œì— ì‹¤í–‰í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
2. ì‹¤í–‰ì— ì•ì„œ, ros2 humbleê³¼ qt5, requirementsì˜ pip ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
  - ros2 humble ì„¤ì¹˜: https://docs.ros.org/en/humble/Installation/Alternatives/Ubuntu-Development-Setup.html
  - qt5 ì„¤ì¹˜ (ubuntu 22.04 ê¸°ì¤€)
  ```
  sudo apt-get update
  sudo apt-get upgrade
  sudo apt-get install build-essential make qt5-default qtcreator qtdeclarative5-dev libqt5serialport5-dev 
  ```
  - python ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
  ```
  pip install -r requirements.txt
  ```
3. í”„ë¡œì íŠ¸ì˜ ConfigUtil.py íŒŒì¼ì—ì„œ config.ini íŒŒì¼ì´ ìˆëŠ” ê²½ë¡œ ìˆ˜ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.
  ```
  configParser.read('/home/yoh/deeplearning-repo-4/ros_dl/src/haejo_pkg/haejo_pkg/utils/config.ini')
  config = configParser['yun']
  ```
4. create_and_init.sql íŒŒì¼ë¡œ DBì˜ í…Œì´ë¸”ê³¼ SPë¥¼ ìƒì„±í•˜ê³  ëª¨ë“ˆ í…Œì´ë¸”ì˜ ë°ì´í„°ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
   ```
   source create_and_init.sql
   ```
5. config.iniëŠ” ë‹¤ìŒ í˜•íƒœë¡œ ì‘ì„± í•„ìš”í•©ë‹ˆë‹¤.
  ```
  [dev]
  host = DB Host
  port = DB port
  user = DB user
  password = DB password
  database = DB database name

  GUI = /workspace/ros_dl/src/haejo_pkg/haejo_pkg/haejo.ui
  phone_yolo_model = /workspace/ros_dl/src/haejo_pkg/model/yolov5su.pt
  phone_lstm_model = /workspace/ros_dl/src/haejo_pkg/model/yolo_state_dict.pt

  desk_model = /workspace/ros_dl/src/haejo_pkg/model/desk_best.pt
  door_model = /workspace/ros_dl/src/haejo_pkg/model/door_best.pt
  light_model = /workspace/ros_dl/src/haejo_pkg/model/light_on_off_model.keras
  snack_model = /workspace/ros_dl/src/haejo_pkg/model/snack_best.pt

  video_dir = /workspace/record/
  ```
  - kerasë¥¼ ì œì™¸í•œ ëª¨ë“  ëª¨ë¸ì€ í˜„ì¬ git í”„ë¡œì íŠ¸ì—ì„œ ros_dl/src/haejo_pkg/model ê²½ë¡œ í•˜ìœ„ì— í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
  - keras ëª¨ë¸ì€ êµ¬ê¸€ ë“œë¼ì´ë¸Œì—ì„œ ë°›ì•„ì£¼ì„¸ìš”: https://drive.google.com/file/d/18llPFcgIQBvfEDXJx_6Zr1BPR_P9KzbJ/view?usp=sharing
6. ros2 ì‹¤í–‰
    ```
    source /opt/ros/humble/setup.bash
    ```
7. ros2 í”„ë¡œì íŠ¸ ë¹Œë“œ
  - ros_cam ê²½ë¡œ
    ```
    rosdep init
    rosdep update
    rosdep install --from-paths src --ignore-src -y
    colcon build
    source ./install/local_setup.bash
    ```
  - ros_dl ê²½ë¡œ
    ```
    colcon build
    source ./install/local_setup.bash
    ```
8. ros2 í”„ë¡œì íŠ¸ ì‹¤í–‰
  - ì¹´ë©”ë¼ í† í”½ ë°œí–‰
     ```
     ros2 run usb_cam usb_cam_node_exe
     ```
  - í† í”½ êµ¬ë… ë° UI ì‹¤í–‰
     ```
     ros2 run haejo_pkg deep_learning
     ```

## 4. íŒ€ì› ì†Œê°œ ë° ì—­í• 
|êµ¬ë¶„|ì´ë¦„|ì—­í• |
|---|---|---|
|íŒ€ì¥|ì´ì¶©í•œ|PM, PyQt GUI ê°œë°œ, ë°ì´í„° ë¼ë²¨ë§|
|íŒ€ì›|ê°•ë³‘ì² |CNN/VGG16 ì „ì´í•™ìŠµ, YOLOv5 í™œìš©|
|íŒ€ì›|ì˜¤ìœ¤|ì‹œìŠ¤í…œ êµ¬ì„±ë„ ë° ì‹œë‚˜ë¦¬ì˜¤ ì‘ì„±, YOLOv5 í™œìš©, DB ì„¤ê³„, AWS S3 ì—°ë™, Query/SP ì‘ì„±, Dockerfile/compose.yaml ì‘ì„±|
|íŒ€ì›|ì´ìˆ˜ë¯¼|LSTM/YOLOv8 í™œìš©, ROS2, mediapipe, PyQt|

## 5. íšŒê³ 
- ê¸°ìˆ ì ìœ¼ë¡œ ë§Œì¡±í•œ ì 
  - ë„ì»¤ë¡œ ê°œë°œ í™˜ê²½ êµ¬ì¶•
  - ROS2 í†µì‹  ì—°ë™
  - ì§ì ‘ êµ¬ì¶•í•œ ë°ì´í„°ì…‹ìœ¼ë¡œ ëª¨ë¸ í•™ìŠµ ì§„í–‰
- ì•„ì‰¬ìš´ ì 
  - ë‹¤ì–‘í•œ ë”¥ëŸ¬ë‹ ëª¨ë¸ë¡œ í•™ìŠµí•˜ì§€ ëª»í–ˆê³ , ëª¨ë¸ ê²½ëŸ‰í™”ê°€ ë¶€ì¡±í•˜ì—¬ ì‹¤ì‹œê°„ ì¸ì‹ ì‹œ PC ìì›ì— ë”°ë¼ í™”ë©´ ë²„í¼ë§ ë°œìƒ
  - ë„ì»¤ ìš´ì˜ í™˜ê²½ì„ êµ¬ì¶•í•˜ê³ ì í–ˆìœ¼ë‚˜, UI ì½”ë“œë¥¼ ë¶„ë¦¬í•˜ì§€ ëª»í•´ Qt ë¡œì»¬ í™˜ê²½ ì˜ì¡´ì„± ì´ìŠˆ ë°œìƒ
  - ì›€ì§ì´ëŠ” ë¡œë´‡ì— ì—°ë™ëœ ì¹´ë©”ë¼ë¥¼ ìƒì •í•˜ì—¬ ESP-32 cam ì‚¬ìš© ë° Wifi/TCP/UDP í†µì‹ ì„ ê³ ë ¤í–ˆìœ¼ë‚˜, êµ¬í˜„í•˜ì§€ ëª»í•˜ê³  USB CAMê³¼ ROS í†µì‹ ë§Œ ì‚¬ìš©
